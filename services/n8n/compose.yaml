services:
  n8n:
    build:
      context: ./services/n8n
    profiles: ["n8n"]
    ports:
      - "${N8N_PORT:-5678}:5678"
    volumes:
      - n8n-data:/home/node/.n8n
    environment:
      TZ: ${TIMEZONE:-America/New_York}
      # Skip setup wizard and personalization survey
      N8N_PERSONALIZATION_ENABLED: "false"
      N8N_DIAGNOSTICS_ENABLED: "false"
      N8N_VERSION_NOTIFICATIONS_ENABLED: "false"
      N8N_TEMPLATES_ENABLED: "false"
      # Default owner account
      N8N_DEFAULT_USER_EMAIL: ${N8N_EMAIL:-admin@localhost}
      N8N_DEFAULT_USER_PASSWORD: ${N8N_PASSWORD:-ecosystem}
      # Basic settings
      N8N_HOST: ${N8N_HOST:-localhost}
      N8N_PORT: 5678
      N8N_PROTOCOL: http
      WEBHOOK_URL: ${N8N_WEBHOOK_URL:-http://localhost:5678/}
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:5678/healthz || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 5
    networks:
      - ecosystem

volumes:
  n8n-data:
